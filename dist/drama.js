!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).drama=e()}(this,(function(){"use strict";var t=function(){return t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},t.apply(this,arguments)};function e(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function n(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function o(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}var i,a=function(){function t(t,e){var n=e.ctx,r=e.value;this._plans=[],this.ctx=n,this.name=t,this.value=r,this.enter=void 0,this.leave=void 0,this.get=void 0,this.set=void 0}return t.prototype.load=function(){return n(this,void 0,void 0,(function(){var t,e;return r(this,(function(n){switch(n.label){case 0:return(t=this.ctx._actorRenders[this.name])?(e=this.ready,[4,t(this)]):[3,2];case 1:e.apply(this,[n.sent()]),n.label=2;case 2:return[2]}}))}))},t.prototype.ready=function(t){var n=this;if(t){var r=t.enter,o=t.leave,i=t.get,a=t.set,s=e(t,["enter","leave","get","set"]);this.enter=r,this.leave=o,this.get=i,this.set=function(t){return Object.entries(t).forEach((function(t){var e=t[0],n=t[1];return a(e,n)})),n},Object.entries(s).forEach((function(t){var e=t[0],r=t[1];e in n||(n[e]=r)}))}},t.prototype.executeFrame=function(t,e,n,r){var o=this;if(void 0===t&&(t={}),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.get&&this.set){if(n>0)return function(){return o.executeFrame(t,e,n-16)};var i=Object.entries(t).reduce((function(t,n){var i,a,s,c=n[0],u=n[1],f=t;if("number"==typeof o.get(c)){var l=Math.floor(e/16/o.ctx.speed)-r;l<1&&(l=1);var p=(u-o.get(c))/l,h=o.get(c)+p;if(p>0&&h>u||p<0&&h<u||h===u)return o.set(((i={})[c]=u,i)),f;o.set(((a={})[c]=h,a)),f[c]=u}else o.set(((s={})[c]=u,s));return f}),{});return Object.keys(i).length?function(){return o.executeFrame(i,e,0,r+1)}:void 0}},t.prototype.plan=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),this._plans.push({options:t,duration:e,delay:n}),this},t.prototype.animation=function(t,e,n){var r=this;void 0===e&&(e=0),void 0===n&&(n=0);var o=function(){var t=r._plans.shift();return t&&function(){return r.executeFrame(t.options,t.duration,t.delay)}},i=function(){return t?r.executeFrame(t,e,n):o()};return this.ctx._together?i:new Promise((function(t){var e=function(n){window.requestAnimationFrame((function(){var i=n();if(r.ctx.render(),i)e(i);else{var a=o();a?e(a):t(r)}}))};e(i)}))},t}();!function(t){t[t.stop=0]="stop",t[t.play=1]="play"}(i||(i={}));var s=function(){function s(t){void 0===t&&(t={});var e=t.render,n=void 0===e?function(){}:e;this._frames=[],this._goneFrames=[],this._actorRenders={},this._actionRenders={},this._together=!1,this._speed=1,this._status=i.stop,this.render=n}return Object.defineProperty(s.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t<.2?.2:t>10?10:t},enumerable:!1,configurable:!0}),s.prototype.designAction=function(t,e){if(!/^[a-z][a-z-]+$/.test(t))throw TypeError("".concat(t,' is not a valid name! The name should be in the form of "xxx-xxx"!'));this._actionRenders[t]=e},s.prototype.designActor=function(t,e){this._actorRenders[t]=e},s.prototype.createActors=function(t,e,o){return n(this,void 0,void 0,(function(){var n,i=this;return r(this,(function(r){switch(r.label){case 0:if(!Array.isArray(e))throw TypeError("".concat(e," is not a array!"));return n=e.map((function(n,r){return i.createActor(t,n,(function(t){return o(t,r,e)}))})),[4,Promise.all(n)];case 1:return[2,r.sent()]}}))}))},s.prototype.createActor=function(t,e,o){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,(n=new a(t,{ctx:this,value:e})).load()];case 1:return r.sent(),null==o||o(n),[2,n]}}))}))},s.prototype.createActions=function(t){var n=this,r={},o=function(t){return t.split("-").map((function(t,e){return t.replace(/^(.)/,(function(t){return 0===e?t:t.toUpperCase()}))})).join("")};return t.forEach((function(t){if("string"==typeof t&&n._actionRenders[t]&&(r[o(t)]=n.createAction(t)),"object"==typeof t&&n._actionRenders[t.name]){var i=t.name,a=e(t,["name"]);r[o(i)]=n.createAction(i,a)}})),r},s.prototype.createAction=function(e,i){var a=this;void 0===i&&(i={});var s=i.description;return function(){for(var i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];var u=a._actionRenders[e];if(u){var f={name:e,description:"function"==typeof s?s.apply(void 0,i):s,play:function(e){return n(a,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,u.apply(void 0,o([t(t({},e),{together:this.together.bind(this)})],i,!1))];case 1:return n.sent(),this.render(),[2]}}))}))}};return a._frames.push(f),{code:function(t){if(!t)throw ReferenceError("code callback must be a function!");var e=t();return f.result=e,e}}}return{code:function(t){return t()}}}},s.prototype.prepare=function(){this._frames=[],this._together=!1,this._status=i.stop},s.prototype.together=function(t){var e=this;this._together=!0;var n=t();return new Promise((function(t){var r=function(n){window.requestAnimationFrame((function(){var o=n.map((function(t){return t()})).filter(Boolean);e.render(),o.length?r(o):(e._together=!1,t(void 0))}))};r(n)}))},s.prototype.stop=function(){this._status=i.stop},s.prototype.play=function(o){var a=this;if(void 0===o&&(o=1/0),this._status!==i.play&&this._frames.length){this._status=i.play;var s=this._frames.shift();if(s){var c=s.name,u=s.description,f=s.play,l=e(s,["name","description","play"]),p=0;window.requestAnimationFrame((function(){return n(a,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return f?[4,f(t({name:c,description:u},l))]:[3,2];case 1:e.sent(),e.label=2;case 2:return p+=1,this._goneFrames.push({name:c,description:u}),this._status===i.stop?[2]:(this._status=i.stop,p<o&&this.play(),[2])}}))}))}))}}},s}();return s}));
//# sourceMappingURL=drama.js.map
